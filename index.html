<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            margin: 0;
            background-color: #1a1a1a;
            font-family: 'Press Start 2P', monospace;
            color: #fff;
        }

        .game-container {
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .scoreboard {
            width: 300px;
            background-color: #2a2a2a;
            padding: 20px;
            border: 4px solid #444;
            border-radius: 8px;
        }

        .current-score {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
            color: #4CAF50;
            text-shadow: 2px 2px #000;
        }

        .high-scores {
            margin-top: 20px;
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 150px;
            margin-bottom: 20px;
        }

        .podium-place {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 10px;
        }

        .podium-stand {
            width: 60px;
            background-color: #666;
            border: 2px solid #888;
        }

        .podium-stand.first {
            height: 100px;
            background-color: #FFD700;
        }

        .podium-stand.second {
            height: 80px;
            background-color: #C0C0C0;
        }

        .podium-stand.third {
            height: 60px;
            background-color: #CD7F32;
        }

        .podium-name {
            margin-top: 10px;
            font-size: 12px;
        }

        .score-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .score-list li {
            padding: 8px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
        }

        .score-list li:nth-child(-n+3) {
            display: none;
        }

        canvas {
            border: 4px solid #444;
            background-color: #000;
            image-rendering: pixelated;
        }

        #gameOver {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border: 4px solid #444;
            border-radius: 8px;
            text-align: center;
        }

        .nickname-input {
            background-color: #2a2a2a;
            border: 2px solid #444;
            color: #fff;
            padding: 8px;
            margin: 10px 0;
            font-family: 'Press Start 2P', monospace;
            font-size: 16px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 4px;
            font-family: 'Press Start 2P', monospace;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-area">
            <div class="current-score">Score: 0</div>
            <canvas id="gameCanvas" width="400" height="400"></canvas>
            <div id="gameOver">
                <h2>Game Over!</h2>
                <p>Your score: <span id="finalScore">0</span></p>
                <input type="text" id="nickname" class="nickname-input" placeholder="Enter your nickname" maxlength="10">
                <button onclick="saveScore()">Save Score</button>
                <button onclick="restartGame()">Play Again</button>
            </div>
        </div>
        <div class="scoreboard">
            <h2>High Scores</h2>
            <div class="podium">
                <div class="podium-place">
                    <div class="podium-stand first"></div>
                    <div class="podium-name" id="firstPlace">-</div>
                </div>
                <div class="podium-place">
                    <div class="podium-stand second"></div>
                    <div class="podium-name" id="secondPlace">-</div>
                </div>
                <div class="podium-place">
                    <div class="podium-stand third"></div>
                    <div class="podium-name" id="thirdPlace">-</div>
                </div>
            </div>
            <ul class="score-list" id="scoreList"></ul>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.querySelector('.current-score');
        const gameOverElement = document.getElementById('gameOver');
        const finalScoreElement = document.getElementById('finalScore');

        // Debug information
        console.log('Canvas:', canvas);
        console.log('Context:', ctx);
        console.log('Score element:', scoreElement);

        const GRID_SIZE = 20;
        const GRID_COUNT = canvas.width / GRID_SIZE;
        const SNAKE_COLOR = '#00ff00';
        const FOOD_COLOR = '#ff0000';
        const ZOMBIE_COLOR = '#808080'; // Gray zombie

        let snake = {
            positions: [{x: GRID_COUNT / 2, y: GRID_COUNT / 2}],
            direction: {x: 1, y: 0},
            length: 1,
            score: 0
        };

        let food = {
            position: {x: 0, y: 0}
        };

        let zombie = {
            position: {x: 0, y: 0},
            direction: {x: 0, y: 0}
        };

        let gameLoop;
        let zombieLoop;
        let gameSpeed = 150; // milliseconds between updates
        let zombieSpeed = 300; // zombie moves every 300ms (slower than snake)

        // Score management
        let highScores = JSON.parse(localStorage.getItem('snakeHighScores')) || [];

        function updateScoreDisplay() {
            scoreElement.textContent = `Score: ${snake.score}`;
        }

        function saveScore() {
            const nickname = document.getElementById('nickname').value.trim();
            if (nickname) {
                const newScore = {
                    name: nickname,
                    score: snake.score,
                    date: new Date().toLocaleDateString()
                };
                
                highScores.push(newScore);
                highScores.sort((a, b) => b.score - a.score);
                highScores = highScores.slice(0, 10); // Keep only top 10
                
                localStorage.setItem('snakeHighScores', JSON.stringify(highScores));
                updateScoreboard();
                gameOverElement.style.display = 'none';
                restartGame();
            }
        }

        function updateScoreboard() {
            // Update podium
            if (highScores.length > 0) {
                document.getElementById('firstPlace').textContent = `${highScores[0].name} (${highScores[0].score})`;
            }
            if (highScores.length > 1) {
                document.getElementById('secondPlace').textContent = `${highScores[1].name} (${highScores[1].score})`;
            }
            if (highScores.length > 2) {
                document.getElementById('thirdPlace').textContent = `${highScores[2].name} (${highScores[2].score})`;
            }
            
            // Update score list
            const scoreList = document.getElementById('scoreList');
            scoreList.innerHTML = '';
            
            for (let i = 3; i < highScores.length; i++) {
                const li = document.createElement('li');
                li.innerHTML = `<span>${i + 1}. ${highScores[i].name}</span><span>${highScores[i].score}</span>`;
                scoreList.appendChild(li);
            }
        }

        function randomizeFood() {
            food.position = {
                x: Math.floor(Math.random() * GRID_COUNT),
                y: Math.floor(Math.random() * GRID_COUNT)
            };
            // Make sure food doesn't spawn on snake or zombie
            while (snake.positions.some(pos => pos.x === food.position.x && pos.y === food.position.y) ||
                   (zombie.position.x === food.position.x && zombie.position.y === food.position.y)) {
                food.position = {
                    x: Math.floor(Math.random() * GRID_COUNT),
                    y: Math.floor(Math.random() * GRID_COUNT)
                };
            }
        }

        function randomizeZombie() {
            // Place zombie far from snake
            let attempts = 0;
            do {
                zombie.position = {
                    x: Math.floor(Math.random() * GRID_COUNT),
                    y: Math.floor(Math.random() * GRID_COUNT)
                };
                attempts++;
            } while ((snake.positions.some(pos => pos.x === zombie.position.x && pos.y === zombie.position.y) ||
                     (food.position.x === zombie.position.x && food.position.y === zombie.position.y)) && attempts < 100);
        }

        function moveZombie() {
            const head = snake.positions[0];
            const dx = head.x - zombie.position.x;
            const dy = head.y - zombie.position.y;
            
            // Simple AI: move towards snake
            if (Math.abs(dx) > Math.abs(dy)) {
                // Move horizontally
                zombie.direction = {x: dx > 0 ? 1 : -1, y: 0};
            } else {
                // Move vertically
                zombie.direction = {x: 0, y: dy > 0 ? 1 : -1};
            }
            
            // Move zombie
            zombie.position.x = (zombie.position.x + zombie.direction.x + GRID_COUNT) % GRID_COUNT;
            zombie.position.y = (zombie.position.y + zombie.direction.y + GRID_COUNT) % GRID_COUNT;
        }

        function drawSquare(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x * GRID_SIZE, y * GRID_SIZE, GRID_SIZE, GRID_SIZE);
            ctx.strokeStyle = color === SNAKE_COLOR ? '#00cc00' : color === ZOMBIE_COLOR ? '#666666' : '#cc0000';
            ctx.strokeRect(x * GRID_SIZE, y * GRID_SIZE, GRID_SIZE, GRID_SIZE);
        }

        function drawSnake(x, y) {
            const pixelSize = GRID_SIZE / 4;
            const startX = x * GRID_SIZE;
            const startY = y * GRID_SIZE;
            
            // Snake body (green with darker green pixels)
            ctx.fillStyle = '#00ff00';
            ctx.fillRect(startX, startY, GRID_SIZE, GRID_SIZE);
            
            // Snake pattern (darker green pixels)
            ctx.fillStyle = '#00cc00';
            ctx.fillRect(startX + pixelSize, startY + pixelSize, pixelSize, pixelSize);
            ctx.fillRect(startX + pixelSize * 2, startY + pixelSize * 2, pixelSize, pixelSize);
            
            // Snake eyes (white)
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(startX + pixelSize, startY + pixelSize, pixelSize, pixelSize);
            ctx.fillRect(startX + pixelSize * 2, startY + pixelSize, pixelSize, pixelSize);
            
            // Snake pupils (black)
            ctx.fillStyle = '#000000';
            ctx.fillRect(startX + pixelSize + 1, startY + pixelSize + 1, 2, 2);
            ctx.fillRect(startX + pixelSize * 2 + 1, startY + pixelSize + 1, 2, 2);
        }

        function drawHuman(x, y) {
            const pixelSize = GRID_SIZE / 4;
            const startX = x * GRID_SIZE;
            const startY = y * GRID_SIZE;
            
            // Human body (red)
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(startX + pixelSize, startY + pixelSize * 2, pixelSize * 2, pixelSize * 2);
            
            // Human head (pink)
            ctx.fillStyle = '#ffcccc';
            ctx.fillRect(startX + pixelSize, startY, pixelSize * 2, pixelSize * 2);
            
            // Human eyes (black)
            ctx.fillStyle = '#000000';
            ctx.fillRect(startX + pixelSize + 1, startY + pixelSize, 2, 2);
            ctx.fillRect(startX + pixelSize * 2 + 1, startY + pixelSize, 2, 2);
            
            // Human mouth (black line)
            ctx.fillRect(startX + pixelSize + 1, startY + pixelSize * 2 - 1, pixelSize * 2 - 2, 1);
        }

        function drawZombie(x, y) {
            const pixelSize = GRID_SIZE / 4;
            const startX = x * GRID_SIZE;
            const startY = y * GRID_SIZE;
            
            // Zombie body (gray)
            ctx.fillStyle = '#808080';
            ctx.fillRect(startX + pixelSize, startY + pixelSize * 2, pixelSize * 2, pixelSize * 2);
            
            // Zombie head (dark gray)
            ctx.fillStyle = '#666666';
            ctx.fillRect(startX + pixelSize, startY, pixelSize * 2, pixelSize * 2);
            
            // Zombie eyes (red)
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(startX + pixelSize + 1, startY + pixelSize, 2, 2);
            ctx.fillRect(startX + pixelSize * 2 + 1, startY + pixelSize, 2, 2);
            
            // Zombie mouth (dark red)
            ctx.fillStyle = '#cc0000';
            ctx.fillRect(startX + pixelSize + 1, startY + pixelSize * 2 - 1, pixelSize * 2 - 2, 2);
        }

        function draw() {
            // Clear canvas
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw snake
            snake.positions.forEach((pos, index) => {
                if (index === 0) {
                    // Draw snake head
                    drawSnake(pos.x, pos.y);
                } else {
                    // Draw snake body (simpler)
                    drawSquare(pos.x, pos.y, SNAKE_COLOR);
                }
            });

            // Draw food (human)
            drawHuman(food.position.x, food.position.y);
            
            // Draw zombie
            drawZombie(zombie.position.x, zombie.position.y);
        }

        function moveSnake() {
            const head = {
                x: (snake.positions[0].x + snake.direction.x + GRID_COUNT) % GRID_COUNT,
                y: (snake.positions[0].y + snake.direction.y + GRID_COUNT) % GRID_COUNT
            };

            // Check for collision with self
            if (snake.positions.some(pos => pos.x === head.x && pos.y === head.y)) {
                gameOver();
                return;
            }

            // Check for collision with zombie (any part of snake)
            if (snake.positions.some(pos => pos.x === zombie.position.x && pos.y === zombie.position.y) ||
                (head.x === zombie.position.x && head.y === zombie.position.y)) {
                gameOver();
                return;
            }

            snake.positions.unshift(head);

            // Check if snake ate food
            if (head.x === food.position.x && head.y === food.position.y) {
                snake.score += 1;
                updateScoreDisplay();
                randomizeFood();
            } else {
                snake.positions.pop();
            }
        }

        function gameOver() {
            clearInterval(gameLoop);
            clearInterval(zombieLoop);
            finalScoreElement.textContent = snake.score;
            gameOverElement.style.display = 'block';
        }

        function restartGame() {
            snake = {
                positions: [{x: GRID_COUNT / 2, y: GRID_COUNT / 2}],
                direction: {x: 1, y: 0},
                length: 1,
                score: 0
            };
            updateScoreDisplay();
            gameOverElement.style.display = 'none';
            randomizeFood();
            randomizeZombie();
            
            // Clear existing loops
            if (gameLoop) clearInterval(gameLoop);
            if (zombieLoop) clearInterval(zombieLoop);
            
            // Start new loops
            gameLoop = setInterval(() => {
                moveSnake();
                draw();
            }, gameSpeed);
            
            zombieLoop = setInterval(() => {
                moveZombie();
                draw();
            }, zombieSpeed);
        }

        // Handle keyboard controls
        document.addEventListener('keydown', (event) => {
            switch (event.key) {
                case 'ArrowUp':
                    if (snake.direction.y !== 1) {
                        snake.direction = {x: 0, y: -1};
                    }
                    break;
                case 'ArrowDown':
                    if (snake.direction.y !== -1) {
                        snake.direction = {x: 0, y: 1};
                    }
                    break;
                case 'ArrowLeft':
                    if (snake.direction.x !== 1) {
                        snake.direction = {x: -1, y: 0};
                    }
                    break;
                case 'ArrowRight':
                    if (snake.direction.x !== -1) {
                        snake.direction = {x: 1, y: 0};
                    }
                    break;
            }
        });

        // Alternative initialization for Vercel
        function initGame() {
            console.log('Initializing game...');
            
            // Check if all elements exist
            if (!canvas) {
                console.error('Canvas not found!');
                return;
            }
            if (!ctx) {
                console.error('Canvas context not found!');
                return;
            }
            if (!scoreElement) {
                console.error('Score element not found!');
                return;
            }
            
            try {
                updateScoreboard(); // Initialize scoreboard
                console.log('Scoreboard updated');
                
                randomizeFood();
                console.log('Food randomized');
                
                randomizeZombie();
                console.log('Zombie randomized');
                
                // Clear any existing loops
                if (gameLoop) clearInterval(gameLoop);
                if (zombieLoop) clearInterval(zombieLoop);
                
                // Start game loop
                gameLoop = setInterval(() => {
                    moveSnake();
                    draw();
                }, gameSpeed);
                console.log('Game loop started');
                
                // Start zombie loop (slower)
                zombieLoop = setInterval(() => {
                    moveZombie();
                    draw();
                }, zombieSpeed);
                console.log('Zombie loop started');
            } catch (error) {
                console.error('Error in initGame:', error);
            }
        }

        // Start the game
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded on Vercel');
            console.log('Canvas element:', canvas);
            console.log('Context:', ctx);
            console.log('Score element:', scoreElement);
            
            try {
                initGame();
            } catch (error) {
                console.error('Error starting game:', error);
                // Fallback initialization
                setTimeout(initGame, 100);
            }
        });

        // Fallback for Vercel
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            initGame();
        }
    </script>
</body>
</html> 